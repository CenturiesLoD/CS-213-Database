{% extends "base.html" %}
{% block title %}Spending (Last 12 Months){% endblock %}

{% block content %}
<h2>Spending Overview</h2>

<p>
  Total spending in the last 12 months:
  <strong>{{ total_spending_12m }}</strong>
</p>
<div style="margin-bottom: 1em;">
  <span style="display:inline-block; margin-right: 1.5em;">
    <a href="{{ url_for('customer.spending_custom') }}">
      Custom spending view
    </a>
  </span>
  <span style="display:inline-block;">
    <a href="{{ url_for('customer.dashboard') }}">
      Back to dashboard
    </a>
  </span>
</div>


<h3>Spending by month (last 6 months)</h3>
<canvas id="spendingChart" width="400" height="200"></canvas>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // should work at runtime
    // ignore the error since its reading it as js not jinja
    // get better jinja extension and set the interpreter to Jinja HTML to remove warning
  const spendingLabels = {{ labels|tojson|safe }};
  const spendingValues = {{ values|tojson|safe }};

  const ctx = document.getElementById('spendingChart').getContext('2d');
  const spendingChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: spendingLabels,
      datasets: [{
        label: 'Monthly spending',
        data: spendingValues,
        backgroundColor: 'rgba(54, 162, 235, 0.5)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            // Adjust as needed for your currency
            callback: function(value) {
              return value;
            }
          }
        }
      }
    }
  });
</script>

{% endblock %}

