{% extends "base.html" %}
{% block title %}Customer History{% endblock %}

{% block content %}
<h2>Customer Flight History ({{ airline_name }})</h2>

<form method="post" class="mb-3">
  <div class="mb-2">
    <label for="customer_email" class="form-label">Customer email</label>
    <input
      type="email"
      id="customer_email"
      name="customer_email"
      class="form-control"
      value="{{ customer_email or '' }}"
      required
    >
  </div>
  <button type="submit" class="btn btn-primary btn-sm">Lookup history</button>
</form>

{% if error_msg %}
  <div class="alert alert-warning mt-2">{{ error_msg }}</div>
{% endif %}

{% if results and results|length > 0 %}
  <h3 class="mt-4">Flights for {{ customer_email }}</h3>
  <div class="table-responsive">
    <table class="table table-dark table-striped table-bordered table-sm align-middle mb-0">
      <thead class="table-secondary text-dark">
        <tr>
          <th>Ticket ID</th>
          <th>Airline</th>
          <th>Flight #</th>
          <th>Departure airport</th>
          <th>Departure time</th>
          <th>Arrival airport</th>
          <th>Arrival time</th>
          <th>Status</th>
          <th>Purchase date</th>
        </tr>
      </thead>
      <tbody>
        {% for r in results %}
        <tr>
          <td>{{ r.ticket_id }}</td>
          <td>{{ r.airline_name }}</td>
          <td>{{ r.flight_num }}</td>
          <td>{{ r.departure_airport }}</td>
          <td>{{ r.departure_time }}</td>
          <td>{{ r.arrival_airport }}</td>
          <td>{{ r.arrival_time }}</td>
          <td>{{ r.status }}</td>
          <td>{{ r.purchase_date }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% elif customer_email and not error_msg %}
  <p class="mt-3">No flights found for {{ customer_email }} on {{ airline_name }}.</p>
{% endif %}
{% endblock %}

