{% extends "base.html" %}
{% block title %}Top Customers Analytics{% endblock %}

{% block content %}
<h2>Top Customers</h2>

<h3>By tickets sold (last 6 months)</h3>
{% if top_by_tickets and top_by_tickets|length > 0 %}
  <table border="1" cellpadding="4" cellspacing="0">
    <thead>
      <tr>
        <th>Customer email</th>
        <th>Tickets</th>
      </tr>
    </thead>
    <tbody>
      {% for r in top_by_tickets %}
      <tr>
        <td>{{ r.customer_email }}</td>
        <td>{{ r.ticket_count }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No tickets sold in the last 6 months.</p>
{% endif %}

<h3>By commission (last year)</h3>
{% if top_by_commission and top_by_commission|length > 0 %}
  <table border="1" cellpadding="4" cellspacing="0">
    <thead>
      <tr>
        <th>Customer email</th>
        <th>Total commission</th>
      </tr>
    </thead>
    <tbody>
      {% for r in top_by_commission %}
      <tr>
        <td>{{ r.customer_email }}</td>
        <td>${{ "%.2f"|format(r.total_commission) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No tickets sold in the last year.</p>
{% endif %}

<p style="margin-top: 1em;">
  <a href="{{ url_for('agent.dashboard') }}">Back to dashboard</a>
</p>
{% endblock %}

